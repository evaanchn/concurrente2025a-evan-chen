procedure main()
  shared male_queue := semaphore(0)
  shared female_queue := semaphore(0)
  while read gender do
    case gender of
      'M': create_thread(male)
      'W': create_thread(female)
    end case
  end while
end procedure

procedure male()
  signal(male_queue)  // man arrived
  wait(female_queue)  // wait for woman
  dance()
end procedure

procedure female()
  signal(female_queue)  // woman arrived
  wait(male_queue)  // wait for man
  dance()
end procedure
